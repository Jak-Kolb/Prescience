<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Tracking Console</title>
    <link rel="stylesheet" href="/static/ui.css?v={{ asset_version }}" />
  </head>
  <body>
    <main class="container wide">
      <header class="topbar">
        <h1>Tracking Console</h1>
        <div class="inline-actions">
          <a class="button ghost" href="/ui/zone?sku_id={{ sku_id }}&line_id={{ line_id }}">Define Zone</a>
          <a class="button ghost" href="/">Back to Dashboard</a>
        </div>
      </header>

      <section class="card">
        <h2>Run Tracking</h2>
        <p class="muted">Start a live annotated stream for the selected SKU and camera source.</p>
        <div class="tracking-layout">
          <div class="stack-form">
            <label>SKU</label>
            <select id="tracking-sku">
              {% for sku in skus %}
                <option value="{{ sku.sku_id }}" {% if sku.sku_id == sku_id %}selected{% endif %}>{{ sku.sku_id }}</option>
              {% endfor %}
            </select>
            <label>Model Version</label>
            <select id="tracking-model-version"></select>
            <label>Detection Confidence</label>
            <input id="tracking-conf" type="number" min="0" max="1" step="0.01" value="{{ tracker_conf_default }}" />
            <p class="muted">Fresh models often need low confidence (0.01 to 0.05).</p>
            <label>Counting Direction</label>
            <select id="tracking-direction">
              <option value="left_to_right">left_to_right</option>
              <option value="right_to_left">right_to_left</option>
              <option value="top_to_bottom">top_to_bottom</option>
              <option value="bottom_to_top">bottom_to_top</option>
              <option value="in_and_out">in_and_out</option>
            </select>
            <label>Source</label>
            <input id="tracking-source" type="text" value="0" />
            <label>Line ID</label>
            <input id="tracking-line-id" type="text" value="{{ line_id }}" />
            <label>Device ID</label>
            <input id="tracking-device-id" type="text" value="device-1" />
            <div class="inline-actions">
              <button id="tracking-start" type="button">Start Tracking</button>
              <button id="tracking-stop" class="ghost" type="button">Stop Tracking</button>
            </div>
            <div id="tracking-status" class="muted"></div>
          </div>
          <div class="stream-wrap large">
            <img id="tracking-stream" alt="Tracking stream" />
          </div>
        </div>
      </section>
    </main>

    <script>
      window.PRESCIENCE_TRACKING = {
        skuId: {{ sku_id | tojson }},
        lineId: {{ line_id | tojson }},
        modelsBySku: {{ models_by_sku | tojson }},
        latestVersionBySku: {{ latest_version_by_sku | tojson }},
      };
    </script>
    <script src="/static/tracking.js?v={{ asset_version }}"></script>
  </body>
</html>
